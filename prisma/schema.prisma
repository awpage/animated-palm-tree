generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Entries {
  id           String  @id @unique
  content      String  @db.Text
  deleteOnSeen Boolean @default(false)
  views        Int     @default(0)
  entryVal     Int     @default(autoincrement())
}

model Devices {
  id      String   @id @unique @default(uuid())
  token   String   @unique
  entries String[] @default([])

  sentConnections     ConnectedDevices[] @relation("SenderDevices")
  receivedConnections ConnectedDevices[] @relation("ReceiverDevices")

  sent Messages[] @relation("sentMessages")
  received  Messages[] @relation("receivedMessages")
}

model ConnectedDevices {
  id         String @id @unique @default(uuid())
  receiverId String
  senderId   String

  sender   Devices @relation("SenderDevices", fields: [senderId], references: [id])
  receiver Devices @relation("ReceiverDevices", fields: [receiverId], references: [id])
}


model Messages {
  id  String  @id @unique @default(ulid())
  createdAt DateTime  @default(now())

  type  String  @default("notif") // notif, content
  content String  @db.Text
  delivered Boolean @default(false)
  senderId  String
  recipientId String

  sender  Devices @relation("sentMessages", fields: [senderId], references: [id])
  recipient Devices @relation("receivedMessages", fields: [recipientId], references: [id])
}